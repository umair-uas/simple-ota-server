services:
  nginx:
    image: nginx:alpine
    network_mode: host
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certs:/certs:ro
      - ./data:/data:ro
    depends_on:
      - app
    restart: unless-stopped

  app:
    build: .
    network_mode: host
    environment:
      - DATA_DIR=/data
      - SERVER_URL=${SERVER_URL:-https://localhost:8443}
      - COMPATIBLE=${COMPATIBLE:-iot-gateway-raspberrypi5}
    volumes:
      - ./data:/data
      - ./certs:/certs:ro
      - ./static:/app/static:ro
    restart: unless-stopped
